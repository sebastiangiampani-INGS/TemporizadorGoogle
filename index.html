<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>El Temporizador de Google de Valen</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto+Flex:wght@400;600;800&family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --g-blue:#4285F4;
      --g-red:#EA4335;
      --g-yellow:#FBBC05;
      --g-green:#34A853;

      --bg:#0f0f10;
      --panel: rgba(255,255,255,.06);
      --border: rgba(255,255,255,.12);
      --text:#fff;
      --muted: rgba(255,255,255,.72);
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      background:
        radial-gradient(1100px 650px at 25% 20%, rgba(66,133,244,.18), transparent 55%),
        radial-gradient(1100px 650px at 75% 80%, rgba(52,168,83,.14), transparent 55%),
        var(--bg);
      color:var(--text);
      font-family:"Roboto Flex", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      display:flex;
      align-items:center;
      justify-content:center;
      padding: max(14px, env(safe-area-inset-top)) max(14px, env(safe-area-inset-right))
               max(14px, env(safe-area-inset-bottom)) max(14px, env(safe-area-inset-left));
    }

    .container{
      width:min(1000px, 100%);
      display:flex;
      flex-direction:column;
      gap: 14px;
      align-items:center;
    }

    h1{
      margin:0;
      font-weight:650;
      font-size: clamp(18px, 2.4vw, 30px);
      text-align:center;
    }

    .card{
      width:100%;
      background: linear-gradient(180deg, var(--panel), rgba(255,255,255,.03));
      border: 1px solid var(--border);
      border-radius: 20px;
      padding: clamp(14px, 2.2vw, 22px);
      box-shadow: 0 18px 60px rgba(0,0,0,.35);
      display:flex;
      flex-direction:column;
      gap: 12px;
      align-items:center;
    }

    .timer{
      width:100%;
      display:flex;
      justify-content:center;
      align-items:center;
      overflow:hidden;
    }

    .digits{
      font-family:"Roboto Mono", ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      font-variant-numeric: tabular-nums;
      font-weight:700;
      line-height:1;
      display:flex;
      align-items:baseline;
      justify-content:center;
      gap: clamp(6px, 1.3vw, 16px);
      /* Clave responsive: no se corta */
      font-size: clamp(52px, 12vw, 170px);
      letter-spacing: clamp(1px, .4vw, 6px);
      text-shadow: 0 12px 40px rgba(0,0,0,.55);
      user-select:none;
      white-space:nowrap;
    }

    .sep,.dot{
      color: rgba(255,255,255,.86);
      letter-spacing:0;
      opacity:.9;
      transform: translateY(-0.05em);
    }

    .blue{ color:var(--g-blue); }
    .red{ color:var(--g-red); }
    .yellow{ color:var(--g-yellow); }
    .green{ color:var(--g-green); }

    .hint{
      font-size: 13px;
      color: var(--muted);
      text-align:center;
    }

    .grid{
      width:100%;
      display:grid;
      grid-template-columns: repeat(3, minmax(120px, 1fr));
      gap: 10px;
    }

    @media (max-width: 680px){
      .grid{ grid-template-columns: 1fr; }
    }

    .field{
      display:flex;
      flex-direction:column;
      gap:6px;
      align-items:stretch;
    }

    label{
      font-size:12px;
      color: var(--muted);
    }

    input[type="number"]{
      width:100%;
      padding:10px 12px;
      border-radius: 12px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,.06);
      color: var(--text);
      outline:none;
      font-size:16px;
      text-align:center;
    }

    input:focus{
      border-color: rgba(66,133,244,.6);
      box-shadow: 0 0 0 4px rgba(66,133,244,.15);
    }

    .btnRow{
      width:100%;
      display:grid;
      grid-template-columns: repeat(4, minmax(140px, 1fr));
      gap: 10px;
    }

    @media (max-width: 780px){
      .btnRow{ grid-template-columns: repeat(2, 1fr); }
    }
    @media (max-width: 420px){
      .btnRow{ grid-template-columns: 1fr; }
    }

    button{
      padding: 11px 14px;
      border-radius: 12px;
      border: 1px solid transparent;
      cursor:pointer;
      font-weight: 750;
      font-size: 15px;
      transition: transform .06s ease, filter .15s ease;
    }
    button:active{ transform: translateY(1px); }

    .start{ background: var(--g-blue); color:#fff; }
    .pause{ background: var(--g-yellow); color:#111; }
    .reset{ background: var(--g-red); color:#fff; }
    .full { background: var(--g-green); color:#fff; }

    .shareRow{
      width:100%;
      display:flex;
      gap: 10px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:center;
    }

    #share{
      flex: 1;
      min-width: 240px;
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,.06);
      color: var(--text);
      outline:none;
      font-size: 14px;
    }

    .copy{
      background: rgba(255,255,255,.12);
      border: 1px solid var(--border);
      color: #fff;
    }

    .status{
      font-size: 13px;
      color: var(--muted);
      text-align:center;
    }

    @media (max-height: 700px){
      .digits{ font-size: clamp(44px, 10.8vw, 140px); }
      .hint{ display:none; }
    }
  </style>
</head>

<body>
  <div class="container">
    <h1>El Temporizador de Google de Valen</h1>

    <div class="card">
      <div class="timer">
        <div class="digits" aria-label="temporizador">
          <span class="blue"   id="m1">0</span>
          <span class="red"    id="m2">0</span>
          <span class="sep">:</span>
          <span class="yellow" id="s1">0</span>
          <span class="green"  id="s2">0</span>
          <span class="dot">.</span>
          <span class="blue"   id="c1">0</span>
          <span class="red"    id="c2">0</span>
        </div>
      </div>

      <div class="hint">Espacio = Start/Pause Â· R = Reset Â· F = Pantalla completa</div>

      <div class="grid">
        <div class="field">
          <label for="min">Minutos</label>
          <input type="number" id="min" min="0" max="999" value="6">
        </div>
        <div class="field">
          <label for="sec">Segundos</label>
          <input type="number" id="sec" min="0" max="59" value="5">
        </div>
        <div class="field">
          <label for="cen">CentÃ©simas (00â€“99)</label>
          <input type="number" id="cen" min="0" max="99" value="0">
        </div>
      </div>

      <div class="btnRow">
        <button class="start" id="btnStart">Start</button>
        <button class="pause" id="btnPause">Pause</button>
        <button class="reset" id="btnReset">Reset</button>
        <button class="full"  id="btnFull">Pantalla completa</button>
      </div>

      <div class="shareRow">
        <input id="share" readonly>
        <button class="copy" id="btnCopy">Copiar link</button>
      </div>

      <div class="status" id="status">Listo.</div>
    </div>
  </div>

<script>
(() => {
  const $ = (id) => document.getElementById(id);
  const m1 = $("m1"), m2 = $("m2"), s1 = $("s1"), s2 = $("s2"), c1 = $("c1"), c2 = $("c2");

  const inMin = $("min");
  const inSec = $("sec");
  const inCen = $("cen");

  const share = $("share");
  const status = $("status");

  const btnStart = $("btnStart");
  const btnPause = $("btnPause");
  const btnReset = $("btnReset");
  const btnFull  = $("btnFull");
  const btnCopy  = $("btnCopy");

  const pad2 = (n) => String(Math.max(0, n|0)).padStart(2, "0");

  function clampInt(v, min, max){
    v = Number(v);
    if (!Number.isFinite(v)) v = 0;
    v = Math.floor(v);
    return Math.min(max, Math.max(min, v));
  }

  function beep(){
    try{
      const ctx = new (window.AudioContext || window.webkitAudioContext)();
      const o = ctx.createOscillator();
      const g = ctx.createGain();
      o.type = "sine";
      o.frequency.value = 880;
      g.gain.value = 0.06;
      o.connect(g); g.connect(ctx.destination);
      o.start();
      setTimeout(() => { o.stop(); ctx.close(); }, 650);
    }catch(e){}
  }

  let totalMs = 0;
  let remainingMs = 0;
  let running = false;
  let lastNow = null;
  let raf = null;

  function render(){
    const ms = Math.max(0, remainingMs);
    const totalSec = Math.floor(ms / 1000);
    const minutes = Math.floor(totalSec / 60);
    const seconds = totalSec % 60;
    const centis = Math.floor((ms % 1000) / 10);

    const MM = pad2(minutes);
    const SS = pad2(seconds);
    const CC = pad2(centis);

    m1.textContent = MM[0];
    m2.textContent = MM[1];
    s1.textContent = SS[0];
    s2.textContent = SS[1];
    c1.textContent = CC[0];
    c2.textContent = CC[1];
  }

  function buildLink(){
    const url = new URL(location.href);
    // t en segundos con 2 decimales (centÃ©simas)
    url.searchParams.set("t", (totalMs/1000).toFixed(2));
    url.searchParams.delete("m");
    url.searchParams.delete("s");
    url.searchParams.delete("c");
    url.searchParams.delete("autostart");
    share.value = url.toString();
  }

  function setFromInputs(){
    const m = clampInt(inMin.value, 0, 999);
    const s = clampInt(inSec.value, 0, 59);
    const c = clampInt(inCen.value, 0, 99);

    inMin.value = String(m);
    inSec.value = String(s);
    inCen.value = String(c);

    totalMs = (m*60 + s) * 1000 + (c*10);
    remainingMs = totalMs;

    if (running) pause();
    render();
    buildLink();
    status.textContent = "Listo.";
  }

  function tick(now){
    if (!running) return;
    if (lastNow === null) lastNow = now;

    const dt = now - lastNow;
    lastNow = now;

    remainingMs -= dt;

    if (remainingMs <= 0){
      remainingMs = 0;
      running = false;
      render();
      status.textContent = "TerminÃ³ âœ…";
      beep();
      cancelAnimationFrame(raf);
      raf = null;
      lastNow = null;
      return;
    }

    render();
    raf = requestAnimationFrame(tick);
  }

  function start(){
    if (running) return;

    if (totalMs <= 0){
      status.textContent = "PonÃ© un tiempo primero ðŸ˜…";
      return;
    }

    if (remainingMs <= 0) remainingMs = totalMs;

    running = true;
    status.textContent = "Corriendoâ€¦";
    lastNow = null;
    raf = requestAnimationFrame(tick);
  }

  function pause(){
    if (!running) return;
    running = false;
    status.textContent = "Pausado.";
    if (raf) cancelAnimationFrame(raf);
    raf = null;
    lastNow = null;
    render();
  }

  function resetTimer(){
    pause();
    remainingMs = totalMs;
    render();
    status.textContent = "Reset.";
  }

  async function toggleFull(){
    try{
      if (!document.fullscreenElement) await document.documentElement.requestFullscreen();
      else await document.exitFullscreen();
    }catch(e){}
  }

  async function copyLink(){
    try{
      await navigator.clipboard.writeText(share.value);
      btnCopy.textContent = "Copiado âœ…";
      setTimeout(() => btnCopy.textContent = "Copiar link", 1200);
    }catch(e){
      share.select();
      document.execCommand("copy");
      btnCopy.textContent = "Copiado âœ…";
      setTimeout(() => btnCopy.textContent = "Copiar link", 1200);
    }
  }

  function readParams(){
    const p = new URLSearchParams(location.search);

    // ?t=10.35 (segundos.centÃ©simas)
    if (p.get("t")){
      const sec = Number(p.get("t"));
      if (Number.isFinite(sec) && sec >= 0){
        totalMs = Math.round(sec * 1000);
        remainingMs = totalMs;

        // reflejar inputs
        const totalSec = Math.floor(totalMs / 1000);
        const m = Math.floor(totalSec / 60);
        const s = totalSec % 60;
        const c = Math.floor((totalMs % 1000) / 10);

        inMin.value = String(m);
        inSec.value = String(s);
        inCen.value = String(c);
      }
    }

    // ?m=1&s=30&c=50
    if (p.get("m") || p.get("s") || p.get("c")){
      const m = clampInt(p.get("m") ?? 0, 0, 999);
      const s = clampInt(p.get("s") ?? 0, 0, 59);
      const c = clampInt(p.get("c") ?? 0, 0, 99);

      inMin.value = String(m);
      inSec.value = String(s);
      inCen.value = String(c);

      totalMs = (m*60 + s)*1000 + (c*10);
      remainingMs = totalMs;
    }

    render();
    buildLink();

    if (p.get("autostart") === "1" || p.get("autostart") === "true"){
      start();
    }
  }

  // Eventos
  inMin.addEventListener("input", setFromInputs);
  inSec.addEventListener("input", setFromInputs);
  inCen.addEventListener("input", setFromInputs);

  btnStart.addEventListener("click", start);
  btnPause.addEventListener("click", pause);
  btnReset.addEventListener("click", resetTimer);
  btnFull.addEventListener("click", toggleFull);
  btnCopy.addEventListener("click", copyLink);

  window.addEventListener("keydown", (e) => {
    const tag = (e.target && e.target.tagName) ? e.target.tagName.toLowerCase() : "";
    if (tag === "input" || tag === "textarea") return;

    if (e.code === "Space"){
      e.preventDefault();
      running ? pause() : start();
    } else if (e.key.toLowerCase() === "r"){
      resetTimer();
    } else if (e.key.toLowerCase() === "f"){
      toggleFull();
    }
  });

  // Init
  setFromInputs();
  readParams();
})();
</script>
</body>
</html>

